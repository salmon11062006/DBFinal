<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Booking Portal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='guest_portal.css') }}">
</head>
<body>
    <div class="portal-container">
        <header class="portal-header">
            <h1>üè® Luxury Hotel Booking</h1>
            <p>Book your perfect stay with us</p>
        </header>

        <!-- Login/Register Selection -->
        <div class="booking-section" id="auth-selection">
            <h2>Welcome</h2>
            <p style="text-align: center; margin-bottom: 30px;">Please choose an option to continue</p>
            <div style="display: flex; gap: 20px; justify-content: center;">
                <button class="btn btn-primary" onclick="showLogin()">Login (Existing Guest)</button>
                <button class="btn btn-secondary" onclick="showRegister()">Register (New Guest)</button>
            </div>
        </div>

        <!-- Login Section -->
        <div class="booking-section" id="login-section" style="display: none;">
            <h2>Guest Login</h2>
            <form id="login-form" class="booking-form">
                <div class="form-group">
                    <label>Email Address *</label>
                    <input type="email" id="login-email" placeholder="Enter your registered email" required>
                </div>
                <div class="form-group">
                    <label>Phone Number * (Last 4 digits for verification)</label>
                    <input type="text" id="login-phone" placeholder="Last 4 digits" maxlength="4" required>
                </div>
                <button type="submit" class="btn btn-primary">Login</button>
                <button type="button" class="btn btn-secondary" onclick="backToAuthSelection()">Back</button>
            </form>
        </div>

        <!-- Guest Information Section (Register) -->
        <div class="booking-section" id="register-section" style="display: none;">
            <h2>Register as New Guest</h2>
            <div id="guest-info-display" style="display: none;">
                <div class="info-card">
                    <p><strong>Name:</strong> <span id="display-guest-name"></span></p>
                    <p><strong>Email:</strong> <span id="display-guest-email"></span></p>
                    <p><strong>Phone:</strong> <span id="display-guest-phone"></span></p>
                    <button class="btn btn-secondary" onclick="editGuestInfo()">Edit Info</button>
                    <button class="btn btn-primary" onclick="showBookingForm()">Continue to Booking</button>
                </div>
            </div>

            <form id="guest-info-form" class="booking-form">
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" id="guest-name" placeholder="John Doe" required>
                </div>
                <div class="form-group">
                    <label>Email Address *</label>
                    <input type="email" id="guest-email" placeholder="john@example.com" required>
                </div>
                <div class="form-group">
                    <label>Phone Number *</label>
                    <input type="tel" id="guest-phone" placeholder="+1234567890" required>
                </div>
                <button type="submit" class="btn btn-primary">Register & Continue</button>
                <button type="button" class="btn btn-secondary" onclick="backToAuthSelection()">Back</button>
            </form>
        </div>

        <!-- Logged In User Info -->
        <div class="booking-section" id="logged-in-section" style="display: none;">
            <div class="info-card">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div>
                        <h3>Welcome back, <span id="logged-guest-name"></span>! üëã</h3>
                        <p><strong>Email:</strong> <span id="logged-guest-email"></span></p>
                        <p><strong>Phone:</strong> <span id="logged-guest-phone"></span></p>
                    </div>
                    <button class="btn btn-secondary" onclick="openEditGuestModal()" style="margin-left: 20px;">Edit Info</button>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="showBookingForm()">Make a Reservation</button>
                    <button class="btn btn-secondary" onclick="viewMyBookings()">My Bookings</button>
                    <button class="btn btn-secondary" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>

        <!-- My Bookings Section -->
        <div class="booking-section" id="my-bookings-section" style="display: none;">
            <h2>My Bookings</h2>
            <div id="my-bookings-list"></div>
            <button class="btn btn-secondary" onclick="backToLoggedIn()">Back</button>
        </div>

        <!-- Edit Reservation Modal -->
        <div id="edit-reservation-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeEditReservationModal()">&times;</span>
                <h2>Edit Reservation</h2>
                <form id="edit-reservation-form">
                    <input type="hidden" id="edit-res-id">
                    
                    <div class="form-group">
                        <label>Room (Current)</label>
                        <input type="text" id="edit-res-room" disabled>
                    </div>

                    <div class="form-group">
                        <label>Check-in Date *</label>
                        <input type="date" id="edit-res-checkin" required>
                    </div>
                    <div class="form-group">
                        <label>Check-out Date *</label>
                        <input type="date" id="edit-res-checkout" required>
                    </div>
                    <div class="form-group">
                        <label>Number of Guests *</label>
                        <input type="number" id="edit-res-guests" min="1" max="10" required>
                    </div>

                    <button type="submit" class="btn btn-primary">Update Reservation</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditReservationModal()">Cancel</button>
                </form>
            </div>
        </div>

        <!-- Edit Guest Info Modal -->
        <div id="edit-guest-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeEditGuestModal()">&times;</span>
                <h2>Edit My Information</h2>
                <form id="edit-guest-form">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="edit-guest-name" required>
                    </div>
                    <div class="form-group">
                        <label>Email Address *</label>
                        <input type="email" id="edit-guest-email" required>
                    </div>
                    <div class="form-group">
                        <label>Phone Number *</label>
                        <input type="tel" id="edit-guest-phone" required>
                    </div>

                    <button type="submit" class="btn btn-primary">Update Information</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditGuestModal()">Cancel</button>
                </form>
            </div>
        </div>

        <!-- Room Selection Section -->
        <div class="booking-section" id="room-selection-section" style="display: none;">
            <h2>Select Your Room</h2>
            <div id="available-rooms-list"></div>
        </div>

        <!-- Booking Details Section -->
        <div class="booking-section" id="booking-details-section" style="display: none;">
            <h2>Booking Details</h2>
            <form id="booking-form" class="booking-form">
                <div class="selected-room-info" id="selected-room-info"></div>

                <div class="form-group">
                    <label>Check-in Date *</label>
                    <input type="date" id="booking-checkin" required>
                </div>
                <div class="form-group">
                    <label>Check-out Date *</label>
                    <input type="date" id="booking-checkout" required>
                </div>
                <div class="form-group">
                    <label>Number of Guests *</label>
                    <input type="number" id="booking-guests" min="1" max="10" value="1" required>
                </div>
                <div class="form-group">
                    <label>Coupon Code (Optional)</label>
                    <input type="text" id="booking-coupon" placeholder="Enter coupon code">
                    <button type="button" class="btn btn-secondary" onclick="applyCoupon()">Apply</button>
                </div>

                <div class="price-summary" id="price-summary" style="display: none;">
                    <h3>Price Summary</h3>
                    <p><strong>Room Rate:</strong> $<span id="room-rate">0</span> / night</p>
                    <p><strong>Number of Nights:</strong> <span id="num-nights">0</span></p>
                    <p><strong>Subtotal:</strong> $<span id="subtotal">0</span></p>
                    <p class="discount-line" id="discount-line" style="display: none;">
                        <strong>Discount:</strong> -$<span id="discount-amount">0</span> (<span id="discount-percent">0</span>%)
                    </p>
                    <p class="total-price"><strong>Total:</strong> $<span id="total-price">0</span></p>
                </div>

                <button type="button" class="btn btn-secondary" onclick="backToRoomSelection()">Back</button>
                <button type="submit" class="btn btn-primary">Proceed to Payment</button>
            </form>
        </div>

        <!-- Payment Section -->
        <div class="booking-section" id="payment-section" style="display: none;">
            <h2>Payment</h2>
            <form id="payment-form" class="booking-form">
                <div class="booking-summary" id="booking-summary"></div>

                <h3>Payment Method</h3>
                <div class="payment-methods">
                    <label class="payment-method">
                        <input type="radio" name="payment-method" value="Credit Card" checked>
                        <span>üí≥ Credit Card</span>
                    </label>
                    <label class="payment-method">
                        <input type="radio" name="payment-method" value="Debit Card">
                        <span>üí≥ Debit Card</span>
                    </label>
                    <label class="payment-method">
                        <input type="radio" name="payment-method" value="Cash">
                        <span>üíµ Cash (Pay at Hotel)</span>
                    </label>
                </div>

                <button type="button" class="btn btn-secondary" onclick="backToBooking()">Back</button>
                <button type="submit" class="btn btn-success">Complete Booking</button>
            </form>
        </div>

        <!-- Confirmation Section -->
        <div class="booking-section confirmation-section" id="confirmation-section" style="display: none;">
            <div class="confirmation-icon">‚úÖ</div>
            <h2>Booking Confirmed!</h2>
            <div id="confirmation-details"></div>
            <button class="btn btn-primary" onclick="location.reload()">Make Another Booking</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='guest_portal.js') }}"></script>
</body>
</html>